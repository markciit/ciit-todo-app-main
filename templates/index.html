<!-- Original Version-->
<!DOCTYPE html>
<html>
    <head>
        <title>Sample Web</title>
        <link rel="stylesheet" href="/static/styles.css"/>
    </head>
 
    <body>
        <nav>
            <a href={{ url_for('home') }}>Home </a> | <a href={{ url_for('about') }}>About Me</a>
        </nav>
        <div class="todo-container">
            <h1>To do List</h1>
            <div class="task-input">
                <form method="POST">
                    <input type="text" name="task" placeholder="Add task‚Ä¶" required/>
                    <button>Submit</button>
                </form>
            </div>
            <div class="task-input">
                <form method="POST" action={{ url_for('upload_csv') }} enctype="multipart/form-data">
                    <input type="file" name="csv_file" accept=".csv" required/>
                    <button>Upload Tasks</button>
                </form>
            </div>
             <div class="task-input">
                <form method="GET" action={{ url_for('download_csv') }}>
                    <button>Download</button>
                </form>
            </div>
            <ul id=todo-list>
                {% for task in tasks %}
                <li class="{% if task.done %}done{% endif %}" data-toggle-url="{{ url_for('toggle_task', id=task.id) }}" data-id="{{ task.id }}">
                    
                    <span class="task-text">{{ task.text }}</span>
               
                    <form method="POST" action="{{ url_for('edit_task', id=task.id) }}" class="edit-form" style="display: none;">
                         <!-- <input type="hidden" name="old_task" value="{{ task.id }}"> -->
                        <input type="text" name="new_task" placeholder="{{ task.text }}" required>
                        <button class="edit">‚úîÔ∏è</button>
                        <button type="button" class="cancel-edit">‚úñÔ∏è</button>
                    </form>
 
                    <!-- Edit Toggle Button -->
                    <button type="button" class="edit-toggle">üìù</button>
 
                    <!-- Delete Toggle Button -->
                    <div style="display: flex; gap: 5px;">
                       
                        <form method="POST" action="{{ url_for('delete_task', id=task.id) }}" class="delete-form">
                            <!-- <input type="hidden" name="task_to_delete" value="{{ task.id }}"/>  -->
                            <button class="delete">üóëÔ∏è</button>
                        </form>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        <div>
    
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
            const editButtons = document.querySelectorAll(".edit-toggle");
            const cancelButtons = document.querySelectorAll(".cancel-edit");
            const list = document.getElementById('todo-list');
 
            // Toggle edit form for the clicked item
            editButtons.forEach(button => {
                button.addEventListener("click", function () {
                const li = button.closest("li");                 // the current <li>
                const form = li.querySelector(".edit-form");     // form within this <li>
                const taskText = li.querySelector(".task-text"); // text within this <li>
                
 
                taskText.style.display = "none";
                form.style.display = "flex";
                button.style.display = "none";
                });
            });       
                 // Cancel edit
            cancelButtons.forEach(button => {
                button.addEventListener("click", function () {
                const li = button.closest("li");                 // the current <li>
                const form = li.querySelector(".edit-form");     // form within this <li>
                const taskText = li.querySelector(".task-text"); // text within this <li>
                const editToggle = li.querySelector(".edit-toggle"); // other button within this <li>
 
                taskText.style.display = "inline";
                form.style.display = "none";
                editToggle.style.display = "inline";
                });
            });
             
            if (!list) return;
 
            // Click-to-toggle "done" (ignores clicks on buttons/forms)
            list.addEventListener('click', function (e) {
                if (e.target.closest('button') || e.target.closest('form')) return; // <-- removed stray "="
                const li = e.target.closest('li');
                if (!li) return;
                li.classList.toggle('done');
 
                const url = li.dataset.toogleUrl || `/toggle/${li.dataset.id}`;
 
                fetch(url, { method: "POST" });
                });
            });
            </script>
 
    </body>
</html>